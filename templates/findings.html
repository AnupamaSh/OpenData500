{% extends "main.html" %}
{% autoescape None %}

{% block body %}
		<style type="text/css">

			rect:hover {
				fill: orange;
			}
			
			#tooltip {
				position: absolute;
				width: 200px;
				height: auto;
				padding: 10px;
				background-color: white;
				-webkit-border-radius: 10px;
				-moz-border-radius: 10px;
				border-radius: 10px;
				-webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				-moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				pointer-events: none;
			}
			
			#tooltip.hidden {
				display: none;
			}
			
			#tooltip p {
				margin: 0;
				font-family: sans-serif;
				font-size: 16px;
				line-height: 20px;
			}

			#category-bar-chart {
				margin-bottom: 200px;
			}


		</style>


<div class="findings-page">
    <h1>Findings</h1>
    <p>The Open Data 500 is a living study which the GovLab will maintain and update it on an ongoing basis. We welcome inquiries, input, and comments on our work and findings. Please write to us at <a href="mailto:opendata500@thegovlab.org">OpenData500@thegovlab.org</a> or tweet at @OpenData500 and #OD500.</p>
    <p>Major patterns of open data companies:</p>
    <div class="download-report">
        <h2>Report</h2>
        <p>For a full report on the findings of the Open Data 500 to date, please download the PDF of our report.</p>
        <p><a class="m-button" href="#">Download the report</a></p>
    </div>
    <ul>
        <li>Open government data is a key business resource for hundreds of U.S.-based companies. Previous studies have estimated the broad economic value of open government data, but the Open Data 500 is the first to take a more granular, empirical approach that looks at individual companies in depth. Our results confirm that a variety of government open data is being used by a large number of companies of all kinds.</li>
        <li>Open Data companies operate in a large number of sectors and use very diverse sources of open government data. We found Open Data companies large and small, across the country, in all sectors. Many companies use more than 100 different data sources from a range of government agencies. Conversely, individual agencies not only provide data to a large number of companies, they often serve companies in very different sectors of the economy.</li>
        <li>Open Data companies generate value through a wide variety of operating models. These companies earn revenue from a range of sources, including advertising, sales of services, referrals to other businesses, etc.</li>
    </ul>
    <section>
        <div class="findings-chart">
            <h2>Types of Companies</h2>
            <div id="category-bar-chart"></div>
        </div>
        <div class="findings-chart">
            <h2>Number of Companies Using Each Agency</h2>
            <div id="agency-bar-chart"></div>
        </div>
        <div id="tooltip" class="hidden">
			<p><strong id="tooltip-category-name"></strong></p>
			<p><span id="value">100</span>%</p>
		</div>
    </section>
    
</div>

<script src="http://d3js.org/d3.v3.min.js"></script>

<!-- D3 Graphs -->
<script type="text/javascript">

    var category_bar_data = [
						{name:"Business & Legal Services",value:39},
						{name:"Data/Technology",value:120},
						{name:"Education",value:19},
						{name:"Energy",value:22},
						{name:"Environment & Weather",value:13},
						{name:"Finance & Investment",value:72},
						{name:"Food & Agriculture",value:5},
						{name:"Geospatial/Mapping",value:27},
						{name:"Governance",value:30},
						{name:"Healthcare",value:37},
						{name:"Housing/Real Estate",value:19},
						{name:"Insurance",value:12},
						{name:"Lifestyle & Consumer",value:17},
						{name:"Research & Consulting",value:24},
						{name:"Scientific Research",value:15},
						{name:"Transportation",value:30}]
      
      // var agency_bar_data = [{"Agency":"Administrative Office of the United States Courts ","value":"4"},{"Agency":"Commodity Futures Trading Commission","value":"1"},{"Agency":"Consumer Financial Protection Bureau ","value":"3"},{"Agency":"Corporation for National and Community Service ","value":"0"},{"Agency":"Court Services and Offender Supervision Agency ","value":"0"},{"Agency":"Department of Agriculture ","value":"16"},{"Agency":"Department of Commerce ","value":"116"},{"Agency":"Department of Defense ","value":"7"},{"Agency":"Department of Education ","value":"20"},{"Agency":"Department of Energy ","value":"24"},{"Agency":"Department of Health and Human Services ","value":"71"},{"Agency":"Department of Homeland Security ","value":"9"},{"Agency":"Department of Housing and Urban Development ","value":"1"},{"Agency":"Department of Justice ","value":"9"},{"Agency":"Department of Labor ","value":"27"},{"Agency":"Department of State ","value":"2"},{"Agency":"Department of Transportation ","value":"15"},{"Agency":"Department of Veterans Affairs ","value":"2"},{"Agency":"Department of the Interior ","value":"11"},{"Agency":"Department of the Treasury ","value":"16"},{"Agency":"Executive Office of the President ","value":"1"},{"Agency":"Federal Communications Commission ","value":"2"},{"Agency":"Federal Deposit Insurance Corporation ","value":"3"},{"Agency":"Federal Election Commission ","value":"4"},{"Agency":"Federal Housing Finance Agency ","value":"2"},{"Agency":"Federal Reserve Board ","value":"8"},{"Agency":"General Services Administration ","value":"3"},{"Agency":"Institute of Museum and Library Services ","value":"1"},{"Agency":"National Aeronautics and Space Administration ","value":"5"},{"Agency":"National Archives and Records Administration ","value":"2"},{"Agency":"National Science Foundation ","value":"1"},{"Agency":"Securities and Exchange Commission ","value":"41"},{"Agency":"Social Security Administration ","value":"1"},{"Agency":"US Environmental Protection Agency ","value":"19"},{"Agency":"US Agency for International Development ","value":"1"},{"Agency":"US Consumer Product Safety Commission ","value":"3"},{"Agency":"US Equal Employment Opportunity Commission ","value":"2"},{"Agency":"US International Trade Commission ","value":"1"}];


      		//Width and height
			var margin = {top: 20, right: 20, bottom: 30, left: 40},
			    w = 660 - margin.left - margin.right,
			    h = 500 - margin.top - margin.bottom;
			
			// var dataset = [ { key: 0, value: 5 },		//dataset is now an array of objects.
			// 				{ key: 1, value: 10 },		//Each object has a 'key' and a 'value'.
			// 				{ key: 2, value: 13 },
			// 				{ key: 3, value: 19 },
			// 				{ key: 4, value: 21 },
			// 				{ key: 5, value: 25 },
			// 				{ key: 6, value: 22 },
			// 				{ key: 7, value: 18 },
			// 				{ key: 8, value: 15 },
			// 				{ key: 9, value: 13 },
			// 				{ key: 10, value: 11 },
			// 				{ key: 11, value: 12 },
			// 				{ key: 12, value: 15 },
			// 				{ key: 13, value: 20 },
			// 				{ key: 14, value: 18 },
			// 				{ key: 15, value: 17 },
			// 				{ key: 16, value: 16 },
			// 				{ key: 17, value: 18 },
			// 				{ key: 18, value: 23 },
			// 				{ key: 19, value: 25 } ];
			
			var dataset = category_bar_data;
			var xScale = d3.scale.ordinal()
							.rangeRoundBands([0, w], 0.05);

			var yScale = d3.scale.linear()
							.domain([0, d3.max(dataset, function(d) { return d.value; })])
							.range([0, h]);
			
			var yAxis = d3.svg.axis()
			    .scale(yScale)
			    .orient("left")
			    .ticks(10);

			var xAxis = d3.svg.axis()
			    .scale(xScale)
			    .orient("left")
			    .tickValues(function(d) { return d.name; });

			//Define key function, to be used when binding data
			var key = function(d) {
				return d.key;
			};
			
			//Create SVG element
			var svg = d3.select("#category-bar-chart")
						.append("svg")
						.attr("width", w + 100)
						.attr("height", h + 100);

			//Create bars
			var rect = svg.selectAll("rect")
			   .data(dataset)		//Bind data with custom key function
			   .enter()
			   .append("rect")
			   .attr("x", function(d, i) {
			   		return xScale(i);
			   })
			   .attr("y", function(d) {
			   		return h - yScale(d.value);
			   })
			   .attr("width", xScale.rangeBand())
			   .attr("height", function(d) {
			   		return yScale(d.value);
			   })
			   .attr("fill", function(d) {
					return "rgb(0, 0, " + (d.value * 10) + ")";
			   }).on("mouseover", function(d) {
			   		var coordinates = d3.mouse(this);
					var xPosition = coordinates[0]; //parseFloat(d3.select(this).attr("x")) + xScale.rangeBand() / 2;
					var yPosition = coordinates[1]; //parseFloat(d3.select(this).attr("y")) / 2 + h / 2;
					d3.select("#tooltip")
						.style("left", xPosition + "px")
						.style("top", yPosition + "px")						
						.select("#value")
						.text(d.value);
					d3.select("#tooltip")
						.select("#tooltip-category-name")
						.text(d.name)
					d3.select("#tooltip").classed("hidden", false);
			   })
			   .on("mousemove", mousemove)
			   .on("mouseout", function() {
					d3.select("#tooltip").classed("hidden", true);
			   });
			function mousemove(d, i) {
				var coordinates = d3.mouse(this);
				var xPosition = coordinates[0]; //parseFloat(d3.select(this).attr("x")) + xScale.rangeBand() / 2;
				var yPosition = coordinates[1]; //parseFloat(d3.select(this).attr("y")) / 2 + h / 2;
		   		d3.select("#tooltip")
		   			.style("left", xPosition + "px")
					.style("top", yPosition + "px");
			}

			// var labels = svg.selectAll("text")
			//    .data(dataset)		//Bind data with custom key function
			//    .enter()
			//    .append("text")
			//    .attr("x", function(d, i) {
			//    		return xScale(i) + xScale.rangeBand() / 2;
			//    })
			//    .text(function(d) {
			//    		return d.name;
			//    })
			//    .attr("text-anchor", "left")
			//    .attr("y", function(d) {
			//    		return h + 14;
			//    })
			//    //.attr("transform", "rotate(-65)")
			//    .attr("font-family", "sans-serif")
			//    .attr("font-size", "11px")
			//    .attr("fill", "black");


			svg.append("g")
		        .attr("class", "x axis")
		        .attr("transform", "translate(0," + h + ")")
		        .call(xAxis)
		        .selectAll("text")  
		            .style("text-anchor", "end")
		            .attr("dx", "-.8em")
		            .attr("dy", ".15em")
		            .attr("transform", function(d) {
		                return "rotate(-65)" 
		                });

			// //On click, update with new data			
			// d3.select("p")
			// 	.on("click", function() {

			// 		//Remove one value from dataset
			// 		dataset.shift();
					
			// 		//Update scale domains
			// 		xScale.domain(d3.range(dataset.length));
			// 		yScale.domain([0, d3.max(dataset, function(d) { return d.value; })]);

			// 		//Select…
			// 		var bars = svg.selectAll("rect")
			// 			.data(dataset, key);		//Bind data with custom key function

			// 		//Update…
			// 		bars.transition()
			// 			.duration(500)
			// 			.attr("x", function(d, i) {
			// 				return xScale(i);
			// 			})
			// 			.attr("y", function(d) {
			// 				return h - yScale(d.value);
			// 			})
			// 			.attr("width", xScale.rangeBand())
			// 			.attr("height", function(d) {
			// 				return yScale(d.value);
			// 			});



					//Update all labels
					//
					//Exercise: Modify this code to remove the correct label each time!
					//
					// svg.selectAll("text")
					//    .data(dataset, key)		//Bind data with custom key function
					//    .transition()
					//    .duration(500)
					//    .text(function(d) {
					//    		return d.value;
					//    })
					//    .attr("x", function(d, i) {
					// 		return xScale(i) + xScale.rangeBand() / 2;
					//    })
					//    .attr("y", function(d) {
					// 		return h - yScale(d.value) + 14;
					//    });

				// });
</script>


{% end %}