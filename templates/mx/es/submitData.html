{% extends "../../main.html" %}
{% autoescape None %}

{% block body %}

<h1>Información de datos y fuentes de información para {{company.companyName}}</h1>


	<form class="m-form" id="company-data-form" data-parsley-validate>
		
		{% module FormData(country, "es", True, company) %}
		{% raw xsrf_form_html() %}

	</form>

	<!--*****************************************************************-AGENCIES AND SUBAGENCIES-***************************************************************** !-->
	<div class="m-form-box data">
		<h2>Fuentes de datos abiertos gubernamentales</h2>
		<p>Por favor cuéntanos más sobre las fuentes de datos que utiliza tu compañía.</p>
		<p>Puedes usar la herramienta de búsqueda para seleccionar las secretarías, entidades, gobiernos estatales y municipales, o instituciones de la lista disponible.</p>
		<p>Si no puedes encontrar en la lista la fuente que buscas, por favor completa el formulario abajo [link] para sugerir una nueva secretaría, entidades, organización, etc.</p>
		<p><strong>[Opcional]: </strong>Por favor cuéntanos sobre el conjunto de datos que utiliza tu compañía, que pertenecen a las fuentes gubernamentales que seleccionaste. Por favor clasifica cada conjunto de datos en una escala de 1 a 4 (como en el siguiente ejemplo: 1 = pobre, 4 = excelente).</p>
		<p><div class="example-popup"><a>Ver ejemplo.</a></div></p>
		<div class="dialog-example" style="display:none">
			<img src="{{ static_url("img/ExampleData.png") }}">
		</div>
		<div class="ui-widget">
			<label for="tags">Buscar: </label>
			<input id="agencyTags" placeholder="ejemplo: INEGI, Secretaría de Salud, PEMEX, etc..." value="" size="78">
			<input type="hidden" id="searchval" />
			<input type="button" class="l-button" id="addSearchResult" value="Agregar">
			<input type="hidden" class="companyID" name="companyID" value="{{ company.id }}">
			<div class="errors-search">
				<span class="agency-search-error-message" style="display:inline-block;"></span>
			</div>
		</div>
		<div class="agencyList">
			<div id="accordionAgency">
				{% for agency in company.agencies %}
					<h3 class="agency" name='{{agency.name.replace(" ", "-") }}'><a href="#">{{agency.name}}</a>
						<span style="float:right; display: none;" class="toolbar ui-corner-all ui-icon ui-icon-circle-close red" subagency="" agency="{{agency.name.replace(" ","-")}}"></span>
					</h3>
					<div id="{{agency.name.replace(" ","-")}}Accordion">
						<br><h3>Agency Level Datasets</h3><br>
						<table class="datasetTable">
							<tr>
								<th class="table-header-name">Dataset Name</th>
								<th class="table-header-url">Dataset URL</th>
								<th class="table-header-rating">Rating (1-4)</th>
								<th class="table-header-buttons"></th>
							</tr>
							{% for d in agency.datasets %}{% if company == d.usedBy %}
								<tr class="dataset-row" name="{{d.datasetName}}" subagency="" agency="{{agency.name.replace(" ","-")}}">
									<td><input type="text" name="datasetName" id="datasetName" {% if (d.datasetName) %} value="{{d.datasetName}}" {% end %} ></td>
									<td><input type="text" name="datasetURL" id="datasetURL" {% if (d.datasetURL) %} value="{{d.datasetURL}}" {% end %}></td>
									<td><input type="text" name="rating" id="rating" size="3" {% if (d.rating) %} value="{{d.rating}}" {% end %}></td>
									<td><input type="button" class="l-button" id="saveDataset" value="Save"><input type="button" class="l-button" id="deleteDataset" value="Delete">
										<span class="dataset-error-message" style="display:inline-block;"></span></td>
								</tr>
							{% end %}{% end %}
							<tr class="dataset-row" subagency="" agency="{{agency.name.replace(" ","-")}}" >
								<td><input type="text" name="datasetName" id="datasetName" placeholder="Agency-Level Dataset" value=""></td>
								<td><input type="text" name="datasetURL" id="datasetURL" value=""></td>
								<td><input type="text" name="rating" id="rating" size="3" value=""></td>
								<td><input type="button" class="l-button" id="saveDataset" value="Save"><input type="button" class="l-button" id="deleteDataset" value="Delete" style="display:none">
									<span class="dataset-error-message" style="display:inline-block;"></span></td>
							</tr>
						</table>	<!---END DATASETS FROM JUST AGENCY !-->
						<!-- ROLL THROUGH SUBAGENCIES !-->
						{% if agency.subagencies %}<br><h3>Sub-Agencies</h3><br>{% end %}
						<div id="accordionSubAgency" class="{{agency.name.replace(" ", "-") }}Subagencies">
							{% for sub in agency.subagencies %}{% if company in sub.usedBy %}
								<h3 class="subagency" name="{{sub.name.replace(" ", "-") }}"><a href="#">{{sub.name}}</a>
									<span style="float:right; display: none;" class="toolbar ui-corner-all ui-icon ui-icon-circle-close red" subagency="{{sub.name.replace(" ","-")}}" agency="{{agency.name.replace(" ","-")}}"></span>
								</h3>
								<div class="{{ sub.name.replace(" ", "-") }}">
									<table class="subagencyDatasetTable">
										<tr>
											<th class="table-header-name">Dataset Name</th>
											<th class="table-header-url">Dataset URL</th>
											<th class="table-header-rating">Rating (1-4)</th>
											<th class="table-header-buttons"></th>
										</tr>
										{% for d in sub.datasets %}{%if company == d.usedBy %}
											<tr class="dataset-row" name="{{d.datasetName}}" subagency="{{ sub.name.replace(" ", "-") }}" agency="{{agency.name.replace(" ","-")}}">
												<td><input type="text" name="datasetName" id="datasetName" {% if (d.datasetName) %} value="{{d.datasetName}}" {% end %}></td>
												<td><input type="text" name="datasetURL" id="datasetURL" {% if (d.datasetURL) %} value="{{d.datasetURL}}" {% end %}></td>
												<td><input type="text" name="rating" id="rating" size="3" {% if (d.rating) %} value="{{d.rating}}" {% end %}></td>
												<td><input type="button" class="l-button" id="saveDataset" value="Save"><input type="button" class="l-button" id="deleteDataset" value="Delete">
													<span class="dataset-error-message" style="display:inline-block;"></span></td>
											</tr>
										{% end %}{% end %}
										<tr class="dataset-row" subagency="{{ sub.name.replace(" ", "-") }}" agency="{{agency.name.replace(" ","-")}}">
											<td><input type="text" name="datasetName" id="datasetName" placeholder="Subagency-Level Dataset" value=""></td>
											<td><input type="text" name="datasetURL" id="datasetURL" value=""></td>
											<td><input type="text" name="rating" id="rating" size="3" value=""></td>
											<td><input type="button" class="l-button" id="saveDataset" value="Save"><input type="button" class="l-button" id="deleteDataset" value="Delete" style="display:none">
												<span class="dataset-error-message" style="display:inline-block;"></span></td>
										</tr>
									</table>
								</div>
							{% end %}{% end %} <!-- END OF SUBAGENCIES !-->
						</div>
					</div>
				{% end %}<!-- END OF AGENCIES !-->
			</div><br>
		</div>
	</div>

	<!--*****************************************************************-DATA COMMENTS-***************************************************************** !-->
	<form class="m-form"  id="company-data-comment-form">
		<fieldset class="m-form-half right">
				<h3>Nos interesa tu opinión por lo que nos gustaría saber tus comentarios sobre la utilidad de todas estas fuentes de datos y conjuntos de datos.<br><em>[Máximo 250 palabras] </em></h3>
				<textarea rows="10" cols="59" name="dataComments" id="dataComments" 
				parsley-trigger="keyup" 
				data-parsley-maxwords="250">{%if company.dataComments %}{{ company.dataComments }}{% end %}</textarea><br>
		</fieldset>
	</form>

	<fieldset class="m-form-half">
		<input type="button" id="submit-all-forms" class="m-button" value="Guardar y Terminar">
		<span class="response-message"></span>
	</fieldset>


{% end %}